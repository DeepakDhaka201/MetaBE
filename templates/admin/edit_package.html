{% extends "admin/base.html" %}

{% block title %}Edit Investment Package - Admin{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h2>Edit Investment Package</h2>
                <a href="{{ url_for('admin_investment.list_packages') }}" class="btn btn-secondary">
                    <i class="fas fa-arrow-left"></i> Back to Packages
                </a>
            </div>

            <div class="card">
                <div class="card-body">
                    <form method="POST">
                        <div class="row">
                            <!-- Basic Information -->
                            <div class="col-md-6">
                                <h5 class="mb-3">Basic Information</h5>
                                
                                <div class="form-group">
                                    <label for="name">Package Name *</label>
                                    <input type="text" class="form-control" id="name" name="name" required
                                           value="{{ package.name }}" placeholder="e.g., MXC Launch Package">
                                </div>

                                <div class="form-group">
                                    <label for="description">Description</label>
                                    <textarea class="form-control" id="description" name="description" rows="3"
                                              placeholder="Brief description of the investment package">{{ package.description or '' }}</textarea>
                                </div>

                                <!-- Status and Settings -->
                                <div class="form-group">
                                    <label for="status">Status *</label>
                                    <select class="form-control" id="status" name="status" required>
                                        <option value="active" {% if package.status.value == 'active' %}selected{% endif %}>Active</option>
                                        <option value="cancelled" {% if package.status.value == 'cancelled' %}selected{% endif %}>Cancelled</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <div class="form-check">
                                        <input type="checkbox" class="form-check-input" id="is_featured" name="is_featured" 
                                               {% if package.is_featured %}checked{% endif %}>
                                        <label class="form-check-label" for="is_featured">
                                            Featured Package
                                        </label>
                                    </div>
                                    <small class="form-text text-muted">Featured packages appear at the top</small>
                                </div>

                                <div class="form-group">
                                    <label for="sort_order">Sort Order</label>
                                    <input type="number" class="form-control" id="sort_order" name="sort_order" 
                                           value="{{ package.sort_order }}" min="0" placeholder="0">
                                    <small class="form-text text-muted">Lower numbers appear first</small>
                                </div>
                            </div>

                            <!-- Investment Terms -->
                            <div class="col-md-6">
                                <h5 class="mb-3">Investment Terms</h5>
                                
                                <div class="form-group">
                                    <label for="min_amount">Minimum Investment Amount ($) *</label>
                                    <input type="number" class="form-control" id="min_amount" name="min_amount" 
                                           step="0.01" min="1" required value="{{ package.min_amount }}" placeholder="100.00">
                                </div>

                                <div class="form-group">
                                    <label for="max_amount">Maximum Investment Amount ($)</label>
                                    <input type="number" class="form-control" id="max_amount" name="max_amount" 
                                           step="0.01" min="1" value="{{ package.max_amount or '' }}" placeholder="10000.00">
                                    <small class="form-text text-muted">Leave empty for no limit</small>
                                </div>

                                <div class="form-group">
                                    <label for="total_return_percentage">Total Return Percentage (%) *</label>
                                    <input type="number" class="form-control" id="total_return_percentage" 
                                           name="total_return_percentage" step="0.1" min="0" max="1000" required 
                                           value="{{ package.total_return_percentage }}" placeholder="25.0">
                                    <small class="form-text text-muted">Total return over the entire duration</small>
                                </div>

                                <div class="form-group">
                                    <label for="duration_days">Duration (Days) *</label>
                                    <input type="number" class="form-control" id="duration_days" name="duration_days" 
                                           min="1" max="3650" required value="{{ package.duration_days }}" placeholder="180">
                                    <small class="form-text text-muted">How long the investment runs</small>
                                </div>

                                <div class="form-group">
                                    <label for="end_date">End Date</label>
                                    <input type="date" class="form-control" id="end_date" name="end_date"
                                           value="{{ package.end_date.strftime('%Y-%m-%d') if package.end_date else '' }}">
                                    <small class="form-text text-muted">When package stops accepting new investments</small>
                                </div>
                            </div>
                        </div>

                        <!-- Return Calculation Preview -->
                        <div class="row mt-4">
                            <div class="col-12">
                                <div class="card bg-light">
                                    <div class="card-body">
                                        <h6>Return Calculation Preview</h6>
                                        <div class="row">
                                            <div class="col-md-4">
                                                <strong>Daily Rate:</strong> <span id="daily_rate">0.000%</span>
                                            </div>
                                            <div class="col-md-4">
                                                <strong>Example ($1,000):</strong> $<span id="example_daily">0.00</span>/day
                                            </div>
                                            <div class="col-md-4">
                                                <strong>Total Return ($1,000):</strong> $<span id="example_total">0.00</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="form-group mt-4">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i> Update Package
                            </button>
                            <a href="{{ url_for('admin_investment.list_packages') }}" class="btn btn-secondary ml-2">
                                Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function calculateReturns() {
    const totalReturn = parseFloat(document.getElementById('total_return_percentage').value) || 0;
    const duration = parseInt(document.getElementById('duration_days').value) || 1;
    
    const dailyRate = totalReturn / duration;
    const exampleInvestment = 1000;
    const exampleDaily = (exampleInvestment * dailyRate / 100);
    const exampleTotal = (exampleInvestment * totalReturn / 100);
    
    document.getElementById('daily_rate').textContent = dailyRate.toFixed(3) + '%';
    document.getElementById('example_daily').textContent = exampleDaily.toFixed(2);
    document.getElementById('example_total').textContent = exampleTotal.toFixed(2);
}

// Update calculations when values change
document.getElementById('total_return_percentage').addEventListener('input', calculateReturns);
document.getElementById('duration_days').addEventListener('input', calculateReturns);

// Calculate on page load
document.addEventListener('DOMContentLoaded', function() {
    calculateReturns();
});
</script>
{% endblock %}
